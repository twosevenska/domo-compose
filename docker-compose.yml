version: '3'
services:
    traefik-proxy:
        image: traefik:v2.0
        container_name: traefik-proxy
        command: --api.insecure=true --providers.docker
        volumes:
            - /var/run/docker.sock:/var/run/docker.sock
        ports:
            - 80:80
            - 443:443
            - 8080:8080
        mem_limit: 128m
        restart: always

    homer:
        image: b4bz/homer:latest
        container_name: homer
        volumes:
            - ${RUNTIME}/homer:/www/assets
            - ${CONFIGS}/homer/config.yml:/www/assets/config.yml
            - ${CONFIGS}/homer/logos:/www/assets/logos
            - ${CONFIGS}/homer/icons:/www/assets/icons
        env_file: uidgid.env
        labels:
            - "traefik.http.routers.homer.rule= Host(`${HOSTNAME}`) || Host(`homer.${HOSTNAME}`) || Host(`dashboard.${HOSTNAME}`)"
        ports:
            - 8081:8080
        mem_limit: 64m
        restart: always

    watchtower:
        image: containrrr/watchtower
        container_name: watchtower
        volumes:
            - /var/run/docker.sock:/var/run/docker.sock
        command: --cleanup --interval 7200
        mem_limit: 64m
        restart: always
